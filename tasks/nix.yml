---
- name: "Configure .gitexcludes"
  ansible.builtin.lineinfile:
    path: "~{{ git_user_id }}/.gitexcludes"
    line: "{{ item }}"
    create: true
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: "u=rw,g=r,o=r"
  loop: "{{ git_excludes_items }}"

- name: Ensure .bash_profile exists
  ansible.builtin.file:
    path: "~{{ git_user_id }}/.bash_profile"
    state: touch
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: "u=rw,g=r,o=r"

- name: Add bash-completion to bash_profile
  ansible.builtin.lineinfile:
    path: "~{{ git_user_id }}/.bash_profile"
    line: 'source /usr/local/etc/profile.d/bash_completion.sh'
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: "u=rw,g=r,o=r"

- name: Add show dirty state to bash_profile
  ansible.builtin.lineinfile:
    path: "~{{ git_user_id }}/.bash_profile"
    line: 'GIT_PS1_SHOWDIRTYSTATE=true'
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: "u=rw,g=r,o=r"

- name: Add Git completion for zsh
  ansible.builtin.lineinfile:
    path: "~{{ git_user_id }}/.zshrc.local"
    line: 'autoload -Uz compinit && compinit # line added by diehlabs/ansible-role-git'
    create: true
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: "u=rw,g=r,o=r"

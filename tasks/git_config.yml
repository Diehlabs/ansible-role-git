---
# using init_file instead of git_config because
# git_config sets root:root on the file on linux systems
- name: Manage git config entries
  community.general.ini_file:
    path: "{{ git_config_path }}"
    section: "{{ item.key | split('.') | first }}"
    option: "{{ item.key | split('.') | last }}"
    value: "{{ item.value }}"
    create: yes
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: u=rw,g=r,o=r
  with_dict: "{{ git_config_items_default | combine(git_config_items) }}"

- name: Configure .gitexcludes
  ansible.builtin.blockinfile:
    path: "~{{ git_user_id }}/.gitexcludes"
    create: yes
    owner: "{{ git_user_id }}"
    group: "{{ git_user_group_id }}"
    mode: u=rw,g=r,o=r
    marker: "# {mark} ANSIBLE MANAGED BLOCK - gitexcludes file entries"
    block: |
      {% for line in git_excludes_items_default | union(git_excludes_items) %}
      {{ line }}
      {% endfor %}
